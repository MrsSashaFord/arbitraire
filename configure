#!/bin/sh

. ./.config

print()
{
        printf -- "%s\n" "$*"
}

menu()
{
	print "${projectname}

${description}

${copyright}


	-h|--help               This menu
	--advanced-help         The advanced menu for controlling
                                this configuration system
	--prefix=PREFIX         main installation prefix [${prefixtype}] 

	Variable assignments are honored and passed to the makefile. For
	example:

	./configure --prefix=/home/user/buildarea CC=alternate-cc AS='\$(CC) -x assembler'
	

	
	"
	[ ! -z "$1" ] && exit $1
}

fatal()
{
        (>&2 print "fatal" "$*")
        exit 1
}

prefix="${prefixtype}"



for i in "$@"
do	case "$i" in
		-error)
			menu
			printf "\t"
			print "RUN ./configure first!!"
			print
			exit 1
			;;
		-h|--help)
			menu 0
			;;
		--prefix=*)
			prefix=${i#*=}
			;;
		*=*) 
			# Let these go until the end
			;;
		*)
			fatal "$i is not a valid option !!"
			;;
	esac
done


print "Creating a config.mak to be sourced by the makefile"
print "..."
print "# Automatically generated" > config.mak
print "
prefix = $prefix
libname = $libname
" >> config.mak

for i in "$@"
do	case "$i" in
		*=*)
			print "${i%=*} = ${i#*=}" >> config.mak
			;;
	esac
done

print "done."


